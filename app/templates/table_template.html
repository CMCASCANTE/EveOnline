<table class="data-table {% if market_name %}regional-table{% else %}global-table{% endif %}" id="{{ table_id }}">
    <thead>
        <tr>
            {% set numeric_cols_regional = [0, 1, 2, 3, 4, 5, 6, 7, 8] %}
            {% set numeric_cols_global = [0, 1, 2, 3, 4, 6, 7, 8, 9] %}
            
            {% for header in headers %}
                {% if header == 'Mercado' and not market_name %}
                    {% set i = loop.index0 %}
                    <th class="market-col" 
                        onclick="sortTable('{{ table_id }}', {{ i }}, false)"
                    >
                        {{ header }}
                        <span class="sort-indicator" data-col="{{ i }}"></span>
                    </th>
                {% elif header != 'Mercado' %}
                    {% set i = loop.index0 - (0 if not market_name else 1) %} 
                    
                    {% set is_numeric = (i in numeric_cols_regional and market_name) or (i in numeric_cols_global and not market_name) %}
                    
                    <th {% if 'Item' in header %}class="item-col"
                        {% elif 'ISK' in header or 'Volumen' in header or 'ANÁLISIS' in header %}class="isk-col"
                        {% endif %}
                        onclick="sortTable('{{ table_id }}', {{ i }}, {{ 'true' if is_numeric else 'false' }})"
                    >
                        {{ header }}
                        <span class="sort-indicator" data-col="{{ i }}"></span>
                    </th>
                {% endif %}
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for result in current_results %}
            <tr>
                {# Columna 0: ISK/LP MÁX (Global/Regional) #}
                <td class="isk-col {{ 'positive' if result.isk_per_lp >= 1 else 'negative' }}">
                    {{ "{:,.0f}".format(result.isk_per_lp) }}
                </td>
                
                {# Columna 1: ISK/LP ACTUAL (Global/Regional) #}
                <td class="isk-col {{ 'positive' if result.isk_per_lp_current >= 1 else 'negative' }}">
                    {{ "{:,.0f}".format(result.isk_per_lp_current) }}
                </td>
                
                {# Columna 2: ISK Beneficio MÁX (Global/Regional) #}
                <td class="isk-col {{ 'positive' if result.isk_profit >= 0 else 'negative' }}">
                    {{ "{:,.0f}".format(result.isk_profit) }}
                </td>
                
                {# Columna 3: LP Coste (Global/Regional) #}
                <td class="isk-col">{{ "{:,.0f}".format(result.lp_cost) }}</td>
                
                {# Columna 4: ISK Base Coste (Global/Regional) #}
                <td class="isk-col">{{ "{:,.0f}".format(result.isk_base_cost) }}</td>

                {# Columna 5/No existe: Mercado (Solo Global) #}
                {% if not market_name %}
                    <td class="market-col">{{ result.market }}</td>
                {% endif %}

                {# Columna 5/6: Venta Media (Global/Regional) #}
                <td class="isk-col">{{ "{:,.2f}".format(result.sell_price_avg) }}</td>
                
                {# Columna 6/7: Venta Baja (Global/Regional) #}
                <td class="isk-col">{{ "{:,.2f}".format(result.sell_price_low) }}</td>
                
                {# Columna 7/8: Venta Actual (Global/Regional) #}
                <td class="isk-col">{{ "{:,.2f}".format(result.sell_price_current) }}</td>

                {# Columna 8/9: Volumen 10D (Global/Regional) #}
                <td class="isk-col">{{ "{:,.0f}".format(result.volume_10d) }}</td>

                {# Columna 9/10: Botón Análisis (Global/Regional) #}
                <td>
                    <button
                        data-type-id="{{ result.type_id }}"
                        data-item-name="{{ result.item_name | e }}"
                        data-market-name="{{ result.market }}" 
                        onclick="openModal(this)"
                        class="link-esi"
                    >
                        Detalles
                    </button>
                </td>

                {# Columna 10/11: Item (Global/Regional) #}
                <td class="item-col">{{ result.item_name }} ({{ result.quantity }})</td>
            </tr>
        {% endfor %}
    </tbody>
</table>