<table class="data-table {% if market_name %}regional-table{% else %}global-table{% endif %}">
    <thead>
        <tr>
            {% for header in headers %}
                {% if header == 'Mercado' and not market_name %}
                    <th class="market-col">{{ header }}</th>
                {% elif header != 'Mercado' %}
                    <th {% if 'Item' in header %}class="item-col"{% endif %}
                        {% if 'ISK' in header or 'Volumen' in header or 'ANÁLISIS' in header %}class="isk-col"{% endif %}>
                        {{ header }}
                    </th>
                {% endif %}
            {% endfor %}
        </tr>
    </thead>
    <tbody>
        {% for result in current_results %}
            <tr>
                <td class="isk-col {{ 'positive' if result.isk_per_lp >= 1 else 'negative' }}">
                    {{ "{:,.0f}".format(result.isk_per_lp) }}
                </td>
                <td class="isk-col {{ 'positive' if result.isk_per_lp_current >= 1 else 'negative' }}">
                    {{ "{:,.0f}".format(result.isk_per_lp_current) }}
                </td>
                <td class="{{ 'positive' if result.isk_profit >= 0 else 'negative' }}">
                    {{ "{:,.0f}".format(result.isk_profit) }}
                </td>
                <td>{{ "{:,.0f}".format(result.lp_cost) }}</td>
                <td>{{ "{:,.0f}".format(result.isk_base_cost) }}</td>

                {% if not market_name %}
                    <td class="market-col">{{ result.market }}</td>
                {% endif %}

                <td>{{ "{:,.2f}".format(result.sell_price_avg) }}</td>
                <td>{{ "{:,.2f}".format(result.sell_price_low) }}</td>
                <td>{{ "{:,.2f}".format(result.sell_price_current) }}</td>

                <td>{{ "{:,.0f}".format(result.volume_10d) }}</td>

                <!-- Columna IA ANÁLISIS (Usa data-attributes y llama a handleOrderAnalysis) -->
                <td>
                    <!-- 
                        |e es el filtro 'escape', asegura que el nombre del item se inserte de forma segura en HTML 
                        sin romper la estructura del data-attribute.
                    -->
                    <button
                        data-type-id="{{ result.type_id }}"
                        data-item-name="{{ result.item_name | e }}"
                        onclick="handleOrderAnalysis(this)"
                        class="esi-button"
                    >
                        Ver Órdenes (ESI)
                    </button>                 
                </td>

                <td class="item-col">{{ result.item_name }} ({{ result.quantity }})</td>
            </tr>
        {% endfor %}
    </tbody>
</table>

