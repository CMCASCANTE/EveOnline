<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>An√°lisis Trading Puro</title>
    <style>
        /* Estilos CSS (similares a base_layout.html para la coherencia) */
        body { background-color: #0d1117; color: #ffffff; font-family: sans-serif; line-height: 1.6;}
        .container { max-width: 90%; margin: 20px auto; padding: 20px; background-color: #161b22; border-radius: 10px; }
        h1 { color: #FFA07A; border-bottom: 2px solid #FFA07A; padding-bottom: 10px; text-align: center; }
        h2 { color: #ffeb3b; margin-top: 20px; border-bottom: 1px solid #ffeb3b44; padding-bottom: 5px; text-align: center; }
        .time-info { color: #8b949e; margin-bottom: 20px; text-align: center; }
        
        /* Estilos de tabla */
        .table-container { 
            overflow-x: auto; 
            margin-top: 20px; 
            background-color: #161b22; 
            padding: 15px; 
            border-radius: 6px;
        }
        .data-table { 
            width: 100%; 
            border-collapse: collapse; 
            font-size: 0.9em; 
        }
        .data-table th, .data-table td { 
            padding: 8px 12px; 
            border: 1px solid #30363d;
            text-align: right; 
        }
        .data-table thead th {
            background-color: #30363d;
            color: #FFA07A;
            cursor: pointer;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        .data-table tbody tr:nth-child(even) { background-color: #1f242b; }
        .data-table tbody tr:hover { background-color: #2c333a; }
        .data-table td { color: #ccc; }

        /* Colores de resultados */
        .positive { color: #4CAF50; font-weight: bold; } /* Verde para positivo/alto */
        .market-col { width: 10%; }
        .item-col { text-align: left; width: 30%; }

        /* Estilos de Pesta√±as */
        .tab-button-group { text-align: center; margin-bottom: 20px; }
        .tab-button {
            background-color: #30363d;
            color: white;
            border: none;
            padding: 10px 15px;
            margin: 0 5px;
            cursor: pointer;
            border-radius: 5px;
            transition: background-color 0.3s;
        }
        .tab-button:hover { background-color: #3b424d; }
        .tab-button.active { background-color: #FFA07A; color: black; font-weight: bold; }
        .tab-content { display: none; margin-top: 15px; }
        .tab-content.active { display: block; }

        /* Ordenamiento */
        .sort-indicator { margin-left: 5px; color: #8b949e; }
        .sort-indicator.asc:after { content: "‚ñ≤"; }
        .sort-indicator.desc:after { content: "‚ñº"; }
    </style>
</head>
<body>

<div class="container">
    {% if error %}
        <h1 style="color: #ff3333;">‚ùå Error al Ejecutar el An√°lisis de Trading:</h1>
        <p style="color: #ff3333;">{{ error }}</p>
    {% else %}
        <h1>‚úÖ AN√ÅLISIS DE TRADING PURO FINALIZADO</h1>
        <p class="time-info">Datos actualizados: {{ data.current_time }}</p>

        <div style="margin-bottom: 20px; text-align: center;">
            <a href="{{ url_for('home') }}">
                <button class="tab-button" style="background-color: #1E90FF;">
                    ‚¨ÖÔ∏è IR A INICIO
                </button>
            </a>
            <a href="{{ url_for('analyze') }}">
                <button class="tab-button" style="background-color: #4CAF50;">
                    üí∞ IR A TIENDA LP
                </button>
            </a>
        </div>


        <div class="tab-button-group">
            <button class="tab-button" onclick="openTab(event, 'global-arbitrage')" id="defaultOpen">üí∞ Arbitraje Global (Top Spread)</button>
            <button class="tab-button" onclick="openTab(event, 'global-volume')">üìà Mayor Volumen Global</button>
            
            {% for market in data.markets %}
                <button class="tab-button" onclick="openTab(event, 'market-{{ market | lower }}')">üìç {{ market }}</button>
            {% endfor %}
        </div>
        
        <div id="global-arbitrage" class="tab-content">
            <h2>üí∞ Arbitraje Global (Mejor Spread por Item - Top {{ data.global_arbitrage|length }})</h2>
            {% set current_results = data.global_arbitrage %}
            {% set table_id = 'table-global-arbitrage' %}
            {% include '_trading_table_template.html' with context %}
        </div>

        <div id="global-volume" class="tab-content">
            <h2>üìà Mayor Volumen Global (Top Volumen por Item - Top {{ data.global_volume|length }})</h2>
            {% set current_results = data.global_volume %}
            {% set table_id = 'table-global-volume' %}
            {% include '_trading_table_template.html' with context %}
        </div>
        
        {% for market_name, results in data.market_results.items() %}
            <div id="market-{{ market_name | lower }}" class="tab-content">
                <h2>üìç Trading en {{ market_name }} (Top {{ results|length }})</h2>
                {% set current_results = results %}
                {% set table_id = 'table-market-' + market_name | lower %}
                {% include '_trading_table_template.html' with context %}
            </div>
        {% endfor %}

    {% endif %}

</div>

<script>
    /**
     * Alterna entre las pesta√±as de resultados de trading.
     */
    function openTab(evt, tabId) {
        var i, tabcontent, tablinks;
        
        tabcontent = document.getElementsByClassName("tab-content");
        for (i = 0; i < tabcontent.length; i++) {
            tabcontent[i].style.display = "none";
            tabcontent[i].classList.remove("active");
        }

        tablinks = document.getElementsByClassName("tab-button");
        for (i = 0; i < tablinks.length; i++) {
            tablinks[i].classList.remove("active");
        }

        document.getElementById(tabId).style.display = "block";
        document.getElementById(tabId).classList.add("active");
        evt.currentTarget.classList.add("active");
    }

    // Abrir la primera pesta√±a al cargar la p√°gina
    document.addEventListener("DOMContentLoaded", function() {
        const defaultOpenButton = document.getElementById('defaultOpen');
        if (defaultOpenButton) {
            defaultOpenButton.click();
        }
    });
</script>

</body>
</html>